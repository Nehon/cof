<style>
    .cell{        
        padding:5px;
         {{!-- border: 1px solid #999; --}}
    }
    .cof input:disabled{
        color: #aaaaaa
    }
    .disabled{
        color: #aaaaaa
    }
</style>
<h3 class="form-header">{{localize "COF.ui.properties"}}</h3>
<input class="field-value" name="data.key" type="hidden" value="{{data.key}}" placeholder="{{ localize "COF.ui.key" }}" data-dtype="String">
<div class="form-group stacked">
    <label>{{localize "COF.ui.properties"}}</label>
    <div class="form-fields">        
        <label class="checkbox">
            <input type="checkbox" name="data.limited" {{checked data.limited}}> {{localize "COF.ui.limited"}}
        </label>
        <label class="checkbox">
            <input type="checkbox" name="data.spell" {{checked data.spell}}> {{localize "COF.ui.spell"}}
        </label>            
    </div>

    {{#if data.activable}}    
        
    {{/if}}

    </div>
    <h3 class="form-header">{{localize "COF.ui.effects"}}
        <div class="item-controls" style="display: inline;">
                <a class="item-control item-create capacity-effect-add" title="{{localize "COF.ui.addEffect"}}"><i class="fas fa-plus"></i>&nbsp;</a>
        </div>
    </h3> 
 {{#each data.effects as |effect key|}} 
    <div class="form-fields  flexrow flex-between">
        <div class='flex3 cell'>
            <label class="checkbox">
                <input type="checkbox" name="data.effects.{{@key}}.activable" {{checked effect.activable}}>  {{localize "COF.ui.activable"}} 
            </label>            
        </div>       
        <div class='flex3 cell'>
            <label class="checkbox {{disabled (not effect.activable)}}">
                <input type="checkbox" name="data.effects.{{@key}}.testRoll" {{checked effect.testRoll}}  {{disabled (not effect.activable)}}> {{localize "COF.ui.testRoll"}} 
            </label>
        </div>
        <div class='flex5 cell'>
            <input type="text" value="{{effect.testMod}}" name="data.effects.{{@key}}.testMod" data-dtype="String" {{disabled (or (not effect.testRoll) (not effect.activable))}} placeholder="{{localize "COF.ui.formula"}}"/>
        </div>
        <div class='flex1 cell right' >
            <a class="item-control capacity-effect-delete" title="{{localize "COF.ui.deleteEffect"}}" data-key="{{@key}}"><i class="fas fa-trash"></i>&nbsp;</a>
        </div> 
    </div>        
    <div class="form-fields  flexrow flex-between">       
          <div class='flex3 cell'>
            <label class="checkbox">
                {{localize "COF.ui.effectType"}} 
            </label>            
            <select name="data.effects.{{@key}}.type" data-type="String">
                {{#select effect.type}}
                    <option value="">{{localize "COF.None"}}</option>
                    <option value="damage">{{localize "COF.ui.damage"}}</option>
                    <option value="heal">{{localize "COF.properties.heal"}}</option>
                    <option value="buff">{{localize "COF.properties.buff"}}</option>            
                    <option value="skill">{{localize "COF.ui.skill"}}</option>            
                {{/select}}
            </select> 
        </div>        
        <div class='flex3 cell'>
            <label class="checkbox">             
                {{localize "COF.ui.ranks"}} <output id="rankOut{{@key}}">{{effect.rank}}</output>  {{localize "COF.ui.to"}} <output id="maxRankOut{{@key}}">{{effect.maxRank}}</output>
            </label>
            <div class='flexrow'>
                <input type="range" min="1" max="5" step="1" name="data.effects.{{@key}}.rank" value="{{effect.rank}}" oninput="rankOut{{@key}}.innerHTML=this.value"/>            
                <label class="flex-center">           
                {{localize "COF.ui.to"}}
                </label>
                <input type="range" min="{{effect.rank}}" max="5" step="1" name="data.effects.{{@key}}.maxRank" value="{{effect.maxRank}}"  oninput="maxRankOut{{@key}}.innerHTML=this.value"/>
            </div>
        </div>   
     
       <div class='flex6 cell'>
            <label class="checkbox">
                {{localize "COF.ui.target"}}:
            </label>
            <select name="data.effects.{{@key}}.target" data-type="String">
                {{#select effect.target}}
                    <option value="">{{localize "COF.None"}}</option>
                    <option value="self">{{localize "COF.ui.self"}}</option>
                    <option value="selected">{{localize "COF.ui.selected"}}</option>                
                {{/select}}
            </select> 
        </div>        
    </div>
    <div class="form-fields flexrow flex-between" style="border-bottom:1px #999 solid;padding-bottom:3px">        
        <div class='flex4 cell'>
            <label class="checkbox">
                {{localize "COF.ui.effectValueFormula"}}
            </label>
            <input type="text" value="{{effect.value}}" name="data.effects.{{@key}}.value" data-dtype="String"  placeholder="{{localize "COF.ui.formula"}}">
        </div>
        <div class='flex4 cell'>
            <label class="checkbox {{disabled ( not (equals effect.type 'buff'))}}">
                {{localize "COF.ui.buffedAttribute"}}:
            </label>            
            <select name="data.effects.{{@key}}.stat" data-dtype="String" {{disabled ( not (equals effect.type 'buff'))}}>
            {{#select effect.stat}}
                <option value="">{{localize "COF.None"}}</option>
                <option value="@stats.str.buff">{{localize "COF.stats.str.label"}}</option>
                <option value="@stats.dex.buff">{{localize "COF.stats.dex.label"}}</option>
                <option value="@stats.con.buff">{{localize "COF.stats.con.label"}}</option>
                <option value="@stats.int.buff">{{localize "COF.stats.int.label"}}</option>
                <option value="@stats.wis.buff">{{localize "COF.stats.wis.label"}}</option>
                <option value="@stats.cha.buff">{{localize "COF.stats.cha.label"}}</option>
                <option value="@attacks.melee.buff">{{localize "COF.attacks.melee.label"}}</option>
                <option value="@attacks.ranged.buff">{{localize "COF.attacks.ranged.label"}}</option>
                <option value="@attacks.magic.buff">{{localize "COF.attacks.magic.label"}}</option>
                <option value="@attributes.hp.buff">{{localize "COF.attributes.hp.label"}}</option>
                <option value="@attributes.def.buff">{{localize "COF.attributes.def.label"}}</option>
                <option value="@attributes.init.buff">{{localize "COF.attributes.init.label"}}</option>
                <option value="@attributes.rp.buff">{{localize "COF.attributes.rp.label"}}</option>
                <option value="@attributes.fp.buff">{{localize "COF.attributes.fp.label"}}</option>
                <option value="@attributes.mp.buff">{{localize "COF.attributes.mp.label"}}</option>`
                <option value="@attributes.dr.buff">{{localize "COF.attributes.dr.label"}}</option>
          {{/select}}
        </select>
        </div>
    </div>

 {{/each}}

</div>
